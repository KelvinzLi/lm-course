name: Test Course

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Install UV
      run: curl -LsSf https://astral.sh/uv/install.sh | sh
    
    - name: Install dependencies and run tests
      run: |
        export PATH="$HOME/.local/bin:$PATH"
        uv sync --group dev
        uv run black --check lmcourse/
        uv run flake8 lmcourse/ --max-line-length=80
        uv run pytest --nbval lectures/*/code/*.ipynb --ignore=lectures/*/code/*checkpoint*
